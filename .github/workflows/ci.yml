# name: End-to-end tests ðŸ§ª
# on: [push]
# jobs:
#   cypress-run:
#     runs-on: ubuntu-20.04
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3
#       # Install NPM dependencies, cache them correctly
#       # and run all Cypress tests
#       - name: Cypress run
#         uses: cypress-io/github-action@v6
#         with:
#           config-file: cypress.config.js


name: End-to-end tests ðŸ§ª

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  cypress-run:
    runs-on: ubuntu-20.04

    services:
      my-service:
        image: my-service-image  # Substitua pela imagem do seu serviÃ§o se estiver usando Docker
        ports:
          - 3000:3000            # Certifique-se de que esta porta Ã© a mesma que a usada pelo seu serviÃ§o
        options: --health-cmd="curl --silent --fail http://localhost:3000/health" --health-interval=10s

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install dependencies
        run: npm ci

      - name: Start server
        run: npm start &
        env:
          NODE_ENV: test
        # Adicione um atraso para garantir que o servidor esteja totalmente iniciado
        # Se o servidor for iniciado por um comando diferente, ajuste conforme necessÃ¡rio
        run: sleep 10

      - name: Run Cypress tests
        uses: cypress-io/github-action@v6
        with:
          config-file: cypress.config.js
